<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="https://www.w3.org/2005/Atom">
  <title>CYRTO</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-05-27T11:48:49.446Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>CYRTO</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>&#39;SpringBoot+Mybatis-plus多数据源整合&#39;</title>
    <link href="http://yoursite.com/2020/05/27/SpringBoot-Mybatis-plus%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E6%95%B4%E5%90%88/"/>
    <id>http://yoursite.com/2020/05/27/SpringBoot-Mybatis-plus%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E6%95%B4%E5%90%88/</id>
    <published>2020-05-27T11:31:21.000Z</published>
    <updated>2020-05-27T11:48:49.446Z</updated>
    
    <content type="html"><![CDATA[<p>最近需要跨库进行数据迁移，记录一下使用Springboot+Mybatis-plus进行多数据源配置</p><p>博主的应用场景是有一批数据在测试环境录入，需要将其转移到生产环境，但该任务不要求在线上执行，</p><p>可以只在本地执行，需要同时配置生产环境的数据源和测试环境的数据源</p><h4 id="1-修改yml文件"><a href="#1-修改yml文件" class="headerlink" title="1.修改yml文件"></a>1.修改yml文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#下面的datasource配置只用于本地多数据源配置（数据迁移使用）</span></span><br><span class="line">  <span class="comment">#生产/测试环境应用实际读取的数据源还是从application-prod.yml/application-test.yml单数据源读取</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    dev:</span></span><br><span class="line"><span class="attr">      driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">      jdbc-url:</span> <span class="attr">jdbc:mysql://ip:3306/root?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">    prod:</span></span><br><span class="line"><span class="attr">      driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">      jdbc-url:</span> <span class="attr">jdbc:mysql://ip:3306/root?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">xxx</span></span><br></pre></td></tr></table></figure><h4 id="2-新建DataSourceContextHolder（不同数据源的载体）"><a href="#2-新建DataSourceContextHolder（不同数据源的载体）" class="headerlink" title="2.新建DataSourceContextHolder（不同数据源的载体）"></a>2.新建DataSourceContextHolder（不同数据源的载体）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceContextHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> DataBaseType &#123;</span><br><span class="line">        DEV(<span class="string">"dev"</span>), PROD(<span class="string">"prod"</span>);</span><br><span class="line">        <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">        DataBaseType(String value) &#123;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用ThreadLocal保证线程安全</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; contextHolder = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 往当前线程里设置数据源类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDataSource</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"[将当前数据源改为]："</span> + type);</span><br><span class="line">        contextHolder.set(type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数据源类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String type = StringUtils.isEmpty(contextHolder.get()) ? DataBaseType.DEV.getValue() : contextHolder.get();</span><br><span class="line">        System.err.println(<span class="string">"[获取当前数据源的类型为]："</span> + type);</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空数据类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clearDataBaseType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        contextHolder.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-新建AbstractRoutingDataSource的子类DynamicDataSource，用以实现多数据源"><a href="#3-新建AbstractRoutingDataSource的子类DynamicDataSource，用以实现多数据源" class="headerlink" title="3.新建AbstractRoutingDataSource的子类DynamicDataSource，用以实现多数据源"></a>3.新建AbstractRoutingDataSource的子类DynamicDataSource，用以实现多数据源</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceContextHolder.getDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-新建AOP切面，切点为操作生产环境的业务逻辑所在的包"><a href="#4-新建AOP切面，切点为操作生产环境的业务逻辑所在的包" class="headerlink" title="4.新建AOP切面，切点为操作生产环境的业务逻辑所在的包"></a>4.新建AOP切面，切点为操作生产环境的业务逻辑所在的包</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceAop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.xxx.service.prod..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prodPointCut</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"prodPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDataSourceProd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"prod数据源"</span>);</span><br><span class="line">        DataSourceContextHolder.setDataSource(DataSourceContextHolder.DataBaseType.PROD.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"prodPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataSourceContextHolder.clearDataBaseType();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-配置Mybatis-Plus"><a href="#5-配置Mybatis-Plus" class="headerlink" title="5.配置Mybatis-Plus"></a>5.配置Mybatis-Plus</h4><p>注意，这里使用了@Profile注解，表明该Bean只在dev profile active时生效，即只在本地环境生效<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cyrto</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-27 19:31:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Profile</span>(<span class="string">"dev"</span>)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusDevConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="comment">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span></span><br><span class="line">        <span class="comment">// paginationInterceptor.setOverflow(false);</span></span><br><span class="line">        <span class="comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span></span><br><span class="line">        <span class="comment">// paginationInterceptor.setLimit(500);</span></span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"devDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.dev"</span> )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dev</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"prodDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.prod"</span> )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">prod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">multipleDataSource</span> <span class="params">(@Qualifier(<span class="string">"devDataSource"</span>)</span> DataSource dev,</span></span><br><span class="line"><span class="function">                                          @<span class="title">Qualifier</span><span class="params">(<span class="string">"prodDataSource"</span>)</span> DataSource prod ) </span>&#123;</span><br><span class="line">        DynamicDataSource dynamicDataSource = <span class="keyword">new</span> DynamicDataSource();</span><br><span class="line">        Map&lt; Object, Object &gt; targetDataSources = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        targetDataSources.put(DataSourceContextHolder.DataBaseType.DEV.getValue(), dev );</span><br><span class="line">        targetDataSources.put(DataSourceContextHolder.DataBaseType.PROD.getValue(), prod);</span><br><span class="line">        dynamicDataSource.setTargetDataSources(targetDataSources);</span><br><span class="line">        dynamicDataSource.setDefaultTargetDataSource(dev);</span><br><span class="line">        <span class="keyword">return</span> dynamicDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"sqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MybatisSqlSessionFactoryBean sqlSessionFactory = <span class="keyword">new</span> MybatisSqlSessionFactoryBean();</span><br><span class="line">        sqlSessionFactory.setDataSource(multipleDataSource(dev(),prod()));</span><br><span class="line">        <span class="comment">//sqlSessionFactory.setMapperLocations(new PathMatchingResourcePatternResolver().getResources("classpath:/mapper/*/*Mapper.xml"));</span></span><br><span class="line"></span><br><span class="line">        MybatisConfiguration configuration = <span class="keyword">new</span> MybatisConfiguration();</span><br><span class="line">        <span class="comment">//configuration.setDefaultScriptingLanguage(MybatisXMLLanguageDriver.class);</span></span><br><span class="line">        configuration.setJdbcTypeForNull(JdbcType.NULL);</span><br><span class="line">        configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">        configuration.setCacheEnabled(<span class="keyword">false</span>);</span><br><span class="line">        sqlSessionFactory.setConfiguration(configuration);</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>而生产环境不需要数据迁移的逻辑，我们没有必要为其配置多数据源。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile</span>(<span class="string">"prod"</span>)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="comment">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span></span><br><span class="line">        <span class="comment">// paginationInterceptor.setOverflow(false);</span></span><br><span class="line">        <span class="comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span></span><br><span class="line">        <span class="comment">// paginationInterceptor.setLimit(500);</span></span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近需要跨库进行数据迁移，记录一下使用Springboot+Mybatis-plus进行多数据源配置&lt;/p&gt;
&lt;p&gt;博主的应用场景是有一批数据在测试环境录入，需要将其转移到生产环境，但该任务不要求在线上执行，&lt;/p&gt;
&lt;p&gt;可以只在本地执行，需要同时配置生产环境的数据源和测
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>&#39;zookeeper相关问题.md&#39;</title>
    <link href="http://yoursite.com/2020/03/23/zookeeper%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98-md/"/>
    <id>http://yoursite.com/2020/03/23/zookeeper%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98-md/</id>
    <published>2020-03-23T09:40:08.000Z</published>
    <updated>2020-03-23T09:42:12.156Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Zookeeper相关问题"><a href="#Zookeeper相关问题" class="headerlink" title="Zookeeper相关问题"></a>Zookeeper相关问题</h1><p>[toc]</p><h4 id="Zookeeper分布式锁"><a href="#Zookeeper分布式锁" class="headerlink" title="Zookeeper分布式锁"></a>Zookeeper分布式锁</h4>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Zookeeper相关问题&quot;&gt;&lt;a href=&quot;#Zookeeper相关问题&quot; class=&quot;headerlink&quot; title=&quot;Zookeeper相关问题&quot;&gt;&lt;/a&gt;Zookeeper相关问题&lt;/h1&gt;&lt;p&gt;[toc]&lt;/p&gt;
&lt;h4 id=&quot;Zookeepe
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>2019年总结</title>
    <link href="http://yoursite.com/2019/12/31/2019%E5%B9%B4%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/12/31/2019%E5%B9%B4%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-31T12:13:48.000Z</published>
    <updated>2019-12-31T12:35:20.787Z</updated>
    
    <content type="html"><![CDATA[<p>2019年馬上就要過去，然後是2020年，它同時是21世紀20年代的開端，也是博主人生中最重要的十年吧~</p><p>主要從幾個方面總結壹下：</p><h5 id="工作方面："><a href="#工作方面：" class="headerlink" title="工作方面："></a>工作方面：</h5><p>算是走出了crud的泥潭，加入了壹個remote的startup團隊，leader和同事也比較nice，但也要忍受獨自辦公的孤獨，不過對於喜歡獨處的我來說再合適不過了。</p><h5 id="技术方面："><a href="#技术方面：" class="headerlink" title="技术方面："></a>技术方面：</h5><ul><li>嘗試用多種語言crud，上半年用了壹下Django，最近學習了Go，然後發現，語言遠遠沒有底層知識那麽重要。</li><li>學會了對接(ctrlcv)各種第三方工具</li><li>database design的能力提升了几个level</li><li>對big front end有了新的認識</li><li>重量級框架的源碼嘗試閱讀了幾個，功力貌似還是不夠，有時間明年繼續嘗試</li></ul><p>總體來看，技術方面長進的不算太多，主要是基礎和算法這壹塊欠缺不少。間歇性的想提高算法看到leetcode上的題就有點頭疼。</p><p>就是工資漲了不少，達到了我的預期，是我比較滿意的壹點。</p><h5 id="電子音樂方面："><a href="#電子音樂方面：" class="headerlink" title="電子音樂方面："></a>電子音樂方面：</h5><p>壹年前聽電子音樂可能更多的是為了娛樂，但是今年我已經把它當成壹種藝術來看待，當然對待藝術就不能娛樂至死，而應該嚴謹，嚴肅的去聽。</p><h5 id="生活方面："><a href="#生活方面：" class="headerlink" title="生活方面："></a>生活方面：</h5><p>經歷了壹段無疾而終（也可能是有疾而終，問題出在自己）的感情，有點regret，我是壹個比較情緒化的人，這會導致有點困擾自己，慢慢提高控制情緒的能力。</p><h5 id="明年的計劃："><a href="#明年的計劃：" class="headerlink" title="明年的計劃："></a>明年的計劃：</h5><p>希望參與開發的項目能夠順利上線，持續叠代，比較看好這個東西。</p><p>說實話現在對於技術的研究已經遠遠沒有剛畢業時那麽狂熱了，可能是見得多了看問題的角度也寬泛了。技術也只是壹個比較單點的東西。也可能是我的認知有限，反正還是需要持續學習。</p><p>學習電子音樂制作（或許我的狂熱應該是被它給分走了壹部分），Ableton live和Fl studio都已經備好了，有時間就開始搞。</p><p>在壹個城市呆三年吧，再做下壹步的比較大的打算，所以時間已經過去壹半了，希望走好接下來的壹半。</p><p>祝大家新年快乐:gift_heart:</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;2019年馬上就要過去，然後是2020年，它同時是21世紀20年代的開端，也是博主人生中最重要的十年吧~&lt;/p&gt;
&lt;p&gt;主要從幾個方面總結壹下：&lt;/p&gt;
&lt;h5 id=&quot;工作方面：&quot;&gt;&lt;a href=&quot;#工作方面：&quot; class=&quot;headerlink&quot; title=&quot;工作
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>grpc-spring-boot-starter源码走读</title>
    <link href="http://yoursite.com/2019/12/13/grpc-spring-boot-starter%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB/"/>
    <id>http://yoursite.com/2019/12/13/grpc-spring-boot-starter%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB/</id>
    <published>2019-12-13T02:12:40.000Z</published>
    <updated>2019-12-13T15:02:22.060Z</updated>
    
    <content type="html"><![CDATA[<p>Grpc-spring-boot-starter（<a href="https://github.com/yidongnan/grpc-spring-boot-starter" target="_blank" rel="noopener">Github地址</a>）是一个用于整合Grpc与springboot的开源组件。</p><h4 id="准备知识："><a href="#准备知识：" class="headerlink" title="准备知识："></a>准备知识：</h4><h5 id="ConditionalOnMissingBean"><a href="#ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnMissingBean"></a>@ConditionalOnMissingBean</h5><h5 id="ConditionalOnClass"><a href="#ConditionalOnClass" class="headerlink" title="@ConditionalOnClass"></a>@ConditionalOnClass</h5><h5 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h5><h5 id="ConditionalOnBean"><a href="#ConditionalOnBean" class="headerlink" title="@ConditionalOnBean"></a>@ConditionalOnBean</h5><p>GrpcServerFactoryAutoConfiguration.Java：用于加载Grpc的netty服务器或者InProcess服务器</p><p>1.加载shadedNetty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// First try the shaded netty server</span><br><span class="line">/**</span><br><span class="line"> * Creates a GrpcServerFactory using the shaded netty. This is the recommended default for gRPC.</span><br><span class="line"> *</span><br><span class="line"> * @param properties The properties used to configure the server.</span><br><span class="line"> * @param serviceDiscoverer The discoverer used to identify the services that should be served.</span><br><span class="line"> * @param serverConfigurers The server configurers that contain additional configuration for the server.</span><br><span class="line"> * @return The shadedNettyGrpcServerFactory bean.</span><br><span class="line"> */</span><br><span class="line">@ConditionalOnClass(name = &#123;&quot;io.grpc.netty.shaded.io.netty.channel.Channel&quot;,</span><br><span class="line">        &quot;io.grpc.netty.shaded.io.grpc.netty.NettyServerBuilder&quot;&#125;)</span><br><span class="line">@Conditional(ConditionalOnInterprocessServer.class)</span><br><span class="line">@Bean</span><br><span class="line">public ShadedNettyGrpcServerFactory shadedNettyGrpcServerFactory(final GrpcServerProperties properties,</span><br><span class="line">        final GrpcServiceDiscoverer serviceDiscoverer, final List&lt;GrpcServerConfigurer&gt; serverConfigurers) &#123;</span><br><span class="line">    final ShadedNettyGrpcServerFactory factory = new ShadedNettyGrpcServerFactory(properties, serverConfigurers);</span><br><span class="line">    for (final GrpcServiceDefinition service : serviceDiscoverer.findGrpcServices()) &#123;</span><br><span class="line">        factory.addService(service);</span><br><span class="line">    &#125;</span><br><span class="line">    return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.加载非shadedNetty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@ConditionalOnMissingBean(ShadedNettyGrpcServerFactory.class)</span><br><span class="line">@Conditional(ConditionalOnInterprocessServer.class)</span><br><span class="line">@ConditionalOnClass(name = &#123;&quot;io.netty.channel.Channel&quot;, &quot;io.grpc.netty.NettyServerBuilder&quot;&#125;)</span><br><span class="line">@Bean</span><br><span class="line">public NettyGrpcServerFactory nettyGrpcServerFactory(final GrpcServerProperties properties,</span><br><span class="line">        final GrpcServiceDiscoverer serviceDiscoverer, final List&lt;GrpcServerConfigurer&gt; serverConfigurers) &#123;</span><br><span class="line">    final NettyGrpcServerFactory factory = new NettyGrpcServerFactory(properties, serverConfigurers);</span><br><span class="line">    for (final GrpcServiceDefinition service : serviceDiscoverer.findGrpcServices()) &#123;</span><br><span class="line">        factory.addService(service);</span><br><span class="line">    &#125;</span><br><span class="line">    return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.加载inProcess Netty server(进程内服务器)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ConditionalOnProperty(prefix = &quot;grpc.server&quot;, name = &quot;in-process-name&quot;)</span><br><span class="line">@Bean</span><br><span class="line">public InProcessGrpcServerFactory inProcessGrpcServerFactory(final GrpcServerProperties properties,</span><br><span class="line">        final GrpcServiceDiscoverer serviceDiscoverer) &#123;</span><br><span class="line">    final InProcessGrpcServerFactory factory = new InProcessGrpcServerFactory(properties);</span><br><span class="line">    for (final GrpcServiceDefinition service : serviceDiscoverer.findGrpcServices()) &#123;</span><br><span class="line">        factory.addService(service);</span><br><span class="line">    &#125;</span><br><span class="line">    return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Grpc-spring-boot-starter（&lt;a href=&quot;https://github.com/yidongnan/grpc-spring-boot-starter&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Github地址&lt;/a&gt;）是一个用
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>nginx</title>
    <link href="http://yoursite.com/2019/12/05/%E5%AF%B9nginx%E7%9A%84%E4%B8%80%E4%BA%9B%E7%A0%94%E7%A9%B6/"/>
    <id>http://yoursite.com/2019/12/05/%E5%AF%B9nginx%E7%9A%84%E4%B8%80%E4%BA%9B%E7%A0%94%E7%A9%B6/</id>
    <published>2019-12-05T10:01:06.000Z</published>
    <updated>2020-05-04T02:17:52.348Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对Nginx的一些研究"><a href="#对Nginx的一些研究" class="headerlink" title="对Nginx的一些研究"></a>对Nginx的一些研究</h1><p>最近需要对api域名支持HTTPS，所以简单记录一下如何编写Nginx的配置文件用以支持HTTPS和HTTP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       443 ssl http2;</span><br><span class="line">        server_name  api.xxx.com;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        ssl_certificate &quot;/usr/share/nginx/cert/api.xxx.com.pem&quot;;</span><br><span class="line">        ssl_certificate_key &quot;/usr/share/nginx/cert/api.xxx.com.key&quot;;</span><br><span class="line">        ssl_session_cache shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  10m;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:8080;  </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">            location = /40x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>上面的方法是直接支持HTTP和HTTPS，还有一种做法是只支持HTTPS，对HTTP请求进行强制跳转到HTTPS，需要在上面配置的基础上再加上下面的配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name  www.xxx.com;</span><br><span class="line">    return 301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nginx的默认配置443端口中有一个默认的字段default_server，可能需要去除（可能导致http请求无法返回）</p><p>在前后端分离模式开发的时候有一种情况，静态资源使用了nginx的静态资源目录，占用了一个https域名，比如admin.xxx.com，访问admin.xxx.com</p><p>会直接打开静态前端页面，对应的后台服务如果想共用这个https域名，可以使用nginx的多location配置，使得不同端口转发请求，从而实现</p><p>多端口使用同一个https请求。<br>配置代码：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl http2;</span><br><span class="line">    server_name  admin.xxx.com;    # 这里需要配置服务器的名字，如果是windows本地，一般配成127.0.0.1</span><br><span class="line">    ssl_certificate "/usr/share/nginx/cert/3830179_admin.xxx.com.pem";</span><br><span class="line">    ssl_certificate_key "/usr/share/nginx/cert/3830179_admin.xxx.com.key";</span><br><span class="line">    ssl_session_cache shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout  10m;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    </span><br><span class="line">    index  index.html;</span><br><span class="line">    root  /usr/local/xxx-admin/webapp/dist;</span><br><span class="line">    </span><br><span class="line">    # location = 意为精确匹配，只匹配到根路径，即只返回静态资源，/api不会匹配到</span><br><span class="line">    location = / &#123;</span><br><span class="line">         index index.html index.htm ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    # /api 前没有= 意为模糊前缀匹配，前缀为/api的路由均可以被匹配到，并将请求发送到本地8840端口</span><br><span class="line">    location /api &#123;</span><br><span class="line">         proxy_pass http://127.0.0.1:8840;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h5><blockquote><p><a href="https://help.aliyun.com/document_detail/98728.html?spm=5176.2020520163.0.0.76ac56a7Iw9hhG" target="_blank" rel="noopener">在Nginx/Tengine服务器上安装证书</a></p><p><a href="https://blog.csdn.net/sinat_21302587/article/details/73551583" target="_blank" rel="noopener">nginx 配置https 并兼容http 或强制http 转为https</a></p><p><a href="https://www.cnblogs.com/xiaoliangup/p/9175932.html" target="_blank" rel="noopener">nginx location 详解</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;对Nginx的一些研究&quot;&gt;&lt;a href=&quot;#对Nginx的一些研究&quot; class=&quot;headerlink&quot; title=&quot;对Nginx的一些研究&quot;&gt;&lt;/a&gt;对Nginx的一些研究&lt;/h1&gt;&lt;p&gt;最近需要对api域名支持HTTPS，所以简单记录一下如何编写Ngin
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Books To Read In 2018</title>
    <link href="http://yoursite.com/2018/03/22/Books-To-Read-In-2018/"/>
    <id>http://yoursite.com/2018/03/22/Books-To-Read-In-2018/</id>
    <published>2018-03-22T14:23:13.000Z</published>
    <updated>2018-03-27T15:57:52.969Z</updated>
    
    <content type="html"><![CDATA[<p>##已读</p><p>##《颠覆者》-周鸿祎</p><p>##《商业的秘密》<br>《微软的梦工厂》<br>《比特币：一个虚幻而真实的金融世界》<br>《比特币报告》</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##已读&lt;/p&gt;
&lt;p&gt;##《颠覆者》-周鸿祎&lt;/p&gt;
&lt;p&gt;##《商业的秘密》&lt;br&gt;《微软的梦工厂》&lt;br&gt;《比特币：一个虚幻而真实的金融世界》&lt;br&gt;《比特币报告》&lt;/p&gt;

      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2018/03/22/hello-world/"/>
    <id>http://yoursite.com/2018/03/22/hello-world/</id>
    <published>2018-03-22T13:40:38.447Z</published>
    <updated>2018-03-22T13:40:38.447Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
